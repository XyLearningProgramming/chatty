# Chatty application configuration (single merged config).
#
# This file is baked into the Docker image at /app/configs/config.yaml.
# In Kubernetes a ConfigMap (built from this file) is mounted over the
# same path via subPath, replacing the baked-in copy.
#
# Secret values should be injected via environment variables / k8s secrets:
#   CHATTY_LLM__ENDPOINT            – LLM server URL
#   CHATTY_LLM__API_KEY             – LLM API key
#   CHATTY_THIRD_PARTY__POSTGRES_URI – PostgreSQL connection URI
#   CHATTY_THIRD_PARTY__REDIS_URI    – Redis connection URI

# --- LLM (non-secret tunables) ---
llm:
  # endpoint: "http://localhost:8000/api/v1/"  # inject via CHATTY_LLM__ENDPOINT
  # api_key: ""                                # inject via CHATTY_LLM__API_KEY
  model_name: "gpt-3.5-turbo"
  max_tokens: 4096
  temperature: 0.1
  top_p: 0.9
  model_timeout: 300
  max_retries: 3

# --- Third-party (all secrets – inject via env) ---
# third_party:
#   postgres_uri: "postgresql+asyncpg://app:devsecret@localhost:5432/app"
#   redis_uri: "redis://:devsecret@localhost:6383/0"

# --- API ---
api:
  route_prefix: chatty
  chat_rate_limit_per_second: 3
  request_timeout: 300  # 5 minutes (seconds → timedelta)

# --- Cache ---
cache:
  enabled: true
  max_size: 30
  similarity_threshold: 0.95
  admission_count: 3
  ttl: 86400  # 24 hours (parsed as seconds → timedelta)

# --- Chat ---
chat:
  agent_name: one_step
  max_conversation_length: 3
  tool_timeout: 60  # seconds → timedelta

# --- Embedding (non-secret tunables) ---
embedding:
  # endpoint: "http://localhost:8000/api/v1/"  # inject via CHATTY_EMBEDDING__ENDPOINT
  # api_key: ""                                # inject via CHATTY_EMBEDDING__API_KEY
  model_name: "text-embedding-ada-002"
  dimensions: 1536

# --- RAG ---
rag:
  top_k: 3
  similarity_threshold: 0.7
  cron_interval: 30

# --- Tracing (secrets via env: CHATTY_TRACING__ENDPOINT, etc.) ---
tracing:
  enabled: false
  service_name: chatty
  sample_rate: 0.1
  excluded_urls:
    - /metrics
    - /health

# --- Concurrency gate ---
concurrency:
  max_concurrency: 1
  inbox_max_size: 10

# --- Persona ---
# Three layers: sources (content), tools (agent actions), embed (RAG).
persona:
  name: Xinyu Huang
  character:
    - chatty
    - professional
    - love to share
  expertise:
    - python, golang, cpp
    - llm agent dev
    - web dev
    - devops & k8s

  # Layer 1: Content acquisition
  sources:
    current_homepage:
      description: >
        Personal website meta info: title, author, icons, description.
      content_url: "https://x3huang.dev"
      timeout: 30
      processors:
        - html_head_title_meta

    resume:
      description: >
        Full resume / CV with professional background, skills,
        and experience.
      content_url: "https://x3huang.dev/resume"
      timeout: 30

  # Layer 2: Tool actions (exposed to OneStep agent)
  tools:
    - name: lookup
      type: url_dispatcher
      sources: [current_homepage, resume]
      processors:
        - name: truncate
          max_length: 4000
      description: >
        Look up external information that you don't already know.
        Call when the user asks about something that requires
        live data (e.g. website content, resume details).

  # Layer 3: Embed actions (RAG similarity search)
  embed:
    - source: current_homepage
      match_hints:
        - "personal website"
        - "homepage and online presence"
      processors:
        - name: truncate
          max_length: 2000

    - source: resume
      match_hints:
        - "work experience and career history"
        - "programming languages and technical skills"
        - "education and qualifications"
      processors:
        - name: truncate
          max_length: 3000
