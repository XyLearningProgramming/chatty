# Chatty application configuration (single merged config).
#
# This file is baked into the Docker image at /app/configs/config.yaml.
# In Kubernetes a ConfigMap (built from this file) is mounted over the
# same path via subPath, replacing the baked-in copy.
#
# Secret values should be injected via environment variables / k8s secrets:
#   CHATTY_LLM__ENDPOINT            – LLM server URL
#   CHATTY_LLM__API_KEY             – LLM API key
#   CHATTY_THIRD_PARTY__POSTGRES_URI – PostgreSQL connection URI
#   CHATTY_THIRD_PARTY__REDIS_URI    – Redis connection URI

# --- LLM (non-secret tunables) ---
llm:
  # endpoint: "http://localhost:8000/api/v1/"  # inject via CHATTY_LLM__ENDPOINT
  # api_key: ""                                # inject via CHATTY_LLM__API_KEY
  model_name: "gpt-3.5-turbo"
  max_tokens: 4096
  temperature: 0.1
  top_p: 0.9
  model_timeout: 300
  max_retries: 3

# --- Third-party (all secrets – inject via env) ---
# third_party:
#   postgres_uri: "postgresql+asyncpg://app:password@localhost:5432/app"
#   redis_uri: "redis://:password@localhost:6379/0"

# --- API ---
api:
  route_prefix: chatty
  chat_rate_limit_per_second: 3
  request_timeout: 300  # 5 minutes (seconds → timedelta)

# --- Cache ---
cache:
  enabled: true
  max_size: 30
  similarity_threshold: 0.95
  admission_count: 3
  ttl: 86400  # 24 hours (parsed as seconds → timedelta)

# --- Chat ---
chat:
  agent_name: one_step
  max_conversation_length: 3
  tool_timeout: 60  # seconds → timedelta

# --- Embedding (non-secret tunables) ---
embedding:
  # endpoint: "http://localhost:8000/api/v1/"  # inject via CHATTY_EMBEDDING__ENDPOINT
  # api_key: ""                                # inject via CHATTY_EMBEDDING__API_KEY
  model_name: "text-embedding-ada-002"
  dimensions: 1536

# --- RAG ---
rag:
  top_k: 3
  similarity_threshold: 0.7
  cron_interval: 30

# --- Concurrency gate ---
concurrency:
  max_concurrency: 1
  inbox_max_size: 10

# --- Persona ---
# Knowledge sections are the single source of truth:
#   - OneStep: sections with source_url become URL tools automatically
#   - RAG: all sections are embedded for similarity search
persona:
  name: Xinyu Huang
  character:
    - chatty
    - professional
    - love to share
  expertise:
    - python, golang, cpp
    - llm agent dev
    - web dev
    - devops & k8s
  sections:
    - title: current_homepage
      description: |
        Fetch Xinyu's personal website meta info.
        Returns HTML head with title, author, icon URL, description, etc.
        Use this to answer questions about Xinyu's personal site.
      source_url: "https://x3huang.dev"
      processors:
        - html_head_title_meta

    - title: resume
      description: |
        Fetch Xinyu's resume / CV.
        Returns the full plain-text content of the resume PDF including
        professional background, skills, and experience.
        Use this to answer questions about Xinyu's work experience
        or qualifications.
      source_url: "https://x3huang.dev/resume"
      args:
        max_content_length: 8000
